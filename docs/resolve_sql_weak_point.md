# SQLの苦手を克服する本の学習メモ
## indexについて
### 前提
- 以下の構成を考える。
  - CPU -> キャッシュメモリ ->  HDD
  - キャッシュメモリには、HDDのデータを読み込むと一旦メモリに載るけど、メモリの容量を超えると、捨てられてしまう。
    - キャッシュメモリに載っていないデータはHDDに検索しにいく。
### なぜ速くなるのか
- B+Treeインデックスを用いると、HDDのページをピンポイントで読み出せるようにする。

### indexが役に立たない時（フルスキャンの方が早い時は？）
- HDDのページ数が、`B+Treeの階層` + `条件にヒットした実データ` の数以下の場合は、フルスキャンの方が速い。
  - 条件にヒットしたデータが多すぎると、読み込むページ数が増えるため、フルスキャンとほぼ変わらん。
  - つまり、言い換えると **「検索結果が少ないほど、indexによる効果が大きくなる」** と言える
- 部分一致検索では、前方一致検索ではindexが効くけど、検索結果が非常に多いと、データテーブルのページに大量ヒットするため、インデックスの効果が薄れる。
  - e.g. 読み仮名カラムに対して、`サ%`のような条件で検索した場合には、検索結果が非常に多くなる。

### 発展的な内容
SQLパフォーマンス詳解を読んで、以下の内容を理解した方が良さそう。
- 削除フラグに有効なindexを貼る方法
- 文字数の多いテキスト型のカラムにインデックスを貼る方法
- ngram
  - https://tech.bita.jp/article/4
