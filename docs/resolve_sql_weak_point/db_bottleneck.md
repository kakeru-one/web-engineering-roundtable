# DBがボトルネックになる場合
## DBサーバー内で使われるメモリについて
### バッファプール
- HDD読み出しに関わる部分。
- 主な役割はテーブルのデータをキャッシュしてHDD読み出し回数を減らすこと。
  - MySQLでの用語なので、他のRDBMSでは名称が異なるかも。
- ちなみに、先ほどの節でのメモリは、このバッファプールのことを指している。

### ライブラリバッファ/SQLキャッシュ
- パース・オプティマイズに関わる部分。

### ワークスペース
- DB側で、SQLのソート・JOIN・集計関数などのデータ加工で使われるメモリ。

## JOINさせるとスケールアウトしづらい？
- DBサーバーをスケールアウトする場合を考える。
- ECサイトのアプリケーションかつ、注文履歴という概念があるとする。
  - 閲覧する際は以下のテーブルをJOINする。
    - 売上明細テーブル（トランザクションデータ）
    - 商品マスタテーブル（マスターデータ）
  - 上記のケースで、DBサーバーを以下のようにスケールアウトさせるとすると、JOINする際にサーバーを跨いだ処理になってしまってボトルネックになってしまう。
    - 「マスターデータ用サーバ」
      - 商品マスタテーブル（マスターデータ）
    - 「トランザクションデータ用サーバA」
      - 売上明細テーブル（トランザクションデータ）の前半データ
    - 「トランザクションデータ用サーバB」
      - 売上明細テーブル（トランザクションデータ）の後半データ
  - そこで、以下のような方法を取る。
    - トランザクションデータ用サーバそれぞれに、商品マスタテーブルのデータを全てコピーしておくようにする。
      - これにより、参照系の操作はトランザクションデータ用サーバ内で完結する
    - マスタ系データの更新は、マスタデータ用のサーバーに対してのみ行い、各トランザクション用サーバに自動的に反映させるようにする。
      - これを実現する手段としては、以下がある。
        - DBリンクを使ったマテリアライズドビュー
        - トリガーでコピーする
        - DBリンクがないMySQLの場合は、レプリケーションする

## 前提知識
- スケールアップ
  - サーバーの性能を上げる方法
- スケールアウト
  - サーバーの数を増やす方法っb0
