# JOINについて
## 3つのアルゴリズム
- ネステッドループ結合
  - 外部表の各行に対して、内部表の各行を照らし合わせて、結合判定を行うイメージ。
    - なので、結合条件を適応した結果が外部表10000件かつ内部表10000件だと、10000 × 10000 = 1億レコード分走査する必要が出てくる。
    - 内部表にインデックスが貼られていると、10000件 × （カーティナリティによるけど、かなり小さい数） になるので、かなり高速化される。
      - 比較回数は内部表のカーディナリティ（重複なく値がどれだけ存在するか）に依存する。
  - MySQLではネステッドループ結合がメインのアルゴリズムになってそう。（以下はアルゴリズム）
    - https://dev.mysql.com/doc/refman/8.0/ja/nested-loop-joins.html
    - https://github.com/mysql/mysql-server/blob/trunk/sql/nested_join.h
- ソート/マージ結合
  - 比較対象の列の値で両テーブルの行をソート（並べ替え）し、先頭から順に結合する方式。外部表と内部表の二次元表があるとして、対角線上のものだけを走査するイメージ。
    - https://e-words.jp/w/%E3%82%BD%E3%83%BC%E3%83%88%E3%83%9E%E3%83%BC%E3%82%B8%E7%B5%90%E5%90%88.html
    - ソートする負荷がかかるため、外部表と内部表の結合条件のカラムにはインデックスが貼られていることが前提となる。
- ハッシュ結合
  - 内部表の結合条件列の値をハッシュ関数にかけてメモリ上にハッシュテーブルを作った上で、外部表の値を同じハッシュ関数にかけてマッチングの候補となる内部表の値を探す。
    - 等価結合の場合のみ使用可能。
      - これは、ハッシュ値では、カラムの値の大小比較ができないため。
    - 計算量の観点では、ネステッドループ結合とは異なり、足し算になる。
    - 以下の記事でのアルゴリズムの説明がわかりやすい。
      - https://zenn.dev/captain_blue/articles/three-types-of-join-algorithms#hash-join
      - SQLのハッシュ結合で使用されるハッシュテーブルでは、ハッシュ値の衝突（collision）を許容し、同じハッシュバケット（bucket）に複数の値を格納する。
  - どんな時に使えるかで言うと、結合条件のカラムにindexを貼っていない場合に使える。
  - MySQL、ハッシュ結合も提供してるっぽい。
    - https://dev.mysql.com/doc/refman/8.0/ja/hash-joins.html
    - https://github.com/mysql/mysql-server/blob/824e2b4064053f7daf17d7f3f84b7a3ed92e5fb4/sql/iterators/hash_join_iterator.h

## 前提知識の部分
- ハッシュテーブルとは？  
  - キーと値の組（エントリと呼ぶ）を複数個格納し、キーに対応する値をすばやく参照するためのデータ構造のこと。
  - rubyのHashをイメージするとわかりやすいと思う。
  - https://ja.wikipedia.org/wiki/%E3%83%8F%E3%83%83%E3%82%B7%E3%83%A5%E3%83%86%E3%83%BC%E3%83%96%E3%83%AB
  - https://wa3.i-3-i.info/word11947.html
- ハッシュ関数とは？
  - 任意のデータから、別の（多くの場合は短い固定長の）値を得るための操作、または、その様な値を得るための関数のこと。
    - https://ja.wikipedia.org/wiki/%E3%83%8F%E3%83%83%E3%82%B7%E3%83%A5%E9%96%A2%E6%95%B0
    - https://wa3.i-3-i.info/word11948.html
